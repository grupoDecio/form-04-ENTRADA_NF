function createDataset(e,a,t){log.info("===fdwt_atualiza_fichas===");var d=DatasetBuilder.newDataset();d.addColumn("parentId"),d.addColumn("id"),d.addColumn("acao");for(var i=121,n=0;n<a.length;n++)"parentId"==a[n].fieldName&&(i=Number(a[n].initialValue));for(var o=DatasetFactory.createConstraint("activeVersion",!0,!0,ConstraintType.MUST),r=DatasetFactory.createConstraint("parentDocumentId",i,i,ConstraintType.MUST),l=DatasetFactory.createConstraint("documentPK.companyId",getValue("WKCompany"),getValue("WKCompany"),ConstraintType.MUST),g=DatasetFactory.getDataset("document",["documentPK.documentId"],[o,r,l],["documentPK.documentId"]),s=0;s<g.rowsCount;s++){var c=g.getValue(s,"documentPK.documentId"),u=fluigAPI.getCardAPIService(),_=u.findById(i,c,new java.util.ArrayList,new java.util.ArrayList);log.info("===dadosPai==="),log.dir(_);var f=_.getValues();if(log.info("qtd:"+f.size()),f.size()>0){for(var m=new java.util.ArrayList,I=0;I<f.size();I++)if("anonymization_date"!=f.get(I).getFieldId()&&"anonymization_user_id"!=f.get(I).getFieldId()){var F=com.fluig.sdk.api.cardindex.CardFieldVO();F.setFieldId(f.get(I).getFieldId()),F.setValue(f.get(I).getValue()),m.add(F)}log.info("===camposPaiNovaFicha==="),log.dir(m);var y=u.create(i,m);d.addRow([i,y.getCardId(),"Nova ficha criada"]);var v=u.findChildrenByCardId(c,1,200,new java.util.ArrayList);if(log.info("===dadosFilho==="),log.dir(v),v.items.size()>0)for(I=0;I<v.items.size();I++)for(var C=v.items.get(I).getValues(),p=0;p<C.size();p++)if("tableId"!=C.get(p).getFieldId()&&"rowId"!=C.get(p).getFieldId()&&-1==C.get(p).getFieldId().indexOf("companyid___")&&-1==C.get(p).getFieldId().indexOf("companyid___")&&-1==C.get(p).getFieldId().indexOf("companyid___")&&-1==C.get(p).getFieldId().indexOf("documentid___")&&-1==C.get(p).getFieldId().indexOf("cardid___")&&-1==C.get(p).getFieldId().indexOf("masterid___")&&-1==C.get(p).getFieldId().indexOf("version___")&&-1==C.get(p).getFieldId().indexOf("tableid___")&&-1==C.get(p).getFieldId().indexOf("anonymization_date___")&&-1==C.get(p).getFieldId().indexOf("anonymization_user_id___")){var x=new java.util.ArrayList;F=com.fluig.sdk.api.cardindex.CardFieldVO();F.setFieldId(C.get(p).getFieldId()),F.setValue(C.get(p).getValue()),x.add(F),log.info("===camposFilhoNovaFicha==="),log.dir(x),u.createChild(y.getCardId(),x)}u.remove(c),d.addRow([i,c,"Ficha anterior excluÃ­da"])}}return d}