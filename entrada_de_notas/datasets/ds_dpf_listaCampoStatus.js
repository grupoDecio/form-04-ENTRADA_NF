function createDataset(fields, constraints, sortFields) { log.info("Digte Public Form - @@@ Inicio Dataset ds_dpf_listaCampoStatus.js"); var dataset = DatasetBuilder.newDataset(); var codigoFormularioPublico = ""; var tipo = ""; dataset.addColumn("campo"); dataset.addColumn("campoTabela"); dataset.addColumn("descricaoCampo"); dataset.addColumn("tipo"); if (constraints != null && constraints.length > 0) { for (var i = 0; i < constraints.length; i++) { if (constraints[i].fieldName == "codigoFormularioPublico" && constraints[i].initialValue != "") { codigoFormularioPublico = constraints[i].initialValue; } if (constraints[i].fieldName == "tipo" && constraints[i].initialValue != "") { tipo = constraints[i].initialValue; } } } var constraints = []; if (codigoFormularioPublico != "") { var c1 = DatasetFactory.createConstraint("codigoFormularioPublico", codigoFormularioPublico, codigoFormularioPublico, ConstraintType.MUST); constraints.push(c1); } var dsConfig = DatasetFactory.getDataset("dpf_configuracoes", null, constraints, null); if (dsConfig != undefined && dsConfig != null && dsConfig.rowsCount > 0) { var documentId = dsConfig.getValue(0, "metadata#id"); var documentVersion = dsConfig.getValue(0, "metadata#version"); var constraints = []; var c1 = DatasetFactory.createConstraint("tablename", "tbCamposIdentificacao", "tbCamposIdentificacao", ConstraintType.MUST); constraints.push(c1); var c1 = DatasetFactory.createConstraint("metadata#id", documentId, documentId, ConstraintType.MUST); constraints.push(c1); var c1 = DatasetFactory.createConstraint("metadata#version", documentVersion, documentVersion, ConstraintType.MUST); constraints.push(c1); var c1 = DatasetFactory.createConstraint("metadata#active", "true", "true", ConstraintType.MUST); constraints.push(c1); var dsCampos = DatasetFactory.getDataset("dpf_configuracoes", null, constraints, null); if (dsCampos != undefined && dsCampos != null && dsCampos.rowsCount > 0) { for (var i = 0; i < dsCampos.rowsCount; i++) { if ( dsCampos.getValue(i,"campo") != null && dsCampos.getValue(i,"campo") != "null" && dsCampos.getValue(i,"campo") != "" && (tipo == "campo" || tipo == "")) { var descrcao = dsCampos.getValue(i, "descricaoCampo") != null && dsCampos.getValue(i, "descricaoCampo") != "null" && dsCampos.getValue(i, "descricaoCampo") != "" ? dsCampos.getValue(i, "descricaoCampo") : dsCampos.getValue(i, "campo"); dataset.addRow([ dsCampos.getValue(i, "campo"), dsCampos.getValue(i, "campoTabela"), descrcao, "campo" ]); } if ( dsCampos.getValue(i,"campoTabela") != null && dsCampos.getValue(i,"campoTabela") != "null" && dsCampos.getValue(i,"campoTabela") != "" && (tipo == "campoTabela" || tipo == "")) { var descrcao = dsCampos.getValue(i, "descricaoCampo") != null && dsCampos.getValue(i, "descricaoCampo") != "null" && dsCampos.getValue(i, "descricaoCampo") != "" ? dsCampos.getValue(i, "descricaoCampo") : dsCampos.getValue(i, "campoTabela"); dataset.addRow([ dsCampos.getValue(i, "campo"), dsCampos.getValue(i, "campoTabela"), descrcao, "campoTabela" ]); } } } /*verifica se admissao digitla esta ativa para liberar os campos especificos*/ var c1 = DatasetFactory.createConstraint("metadata#active", "true", "true", ConstraintType.MUST); var dsConfigAdmisao = DatasetFactory.getDataset("dpf_configuracao_admissao_digital", null, [c1], null); if (dsConfigAdmisao != null && dsConfigAdmisao.rowsCount >= 0 && (tipo == "campoTabela" || tipo == "")){ var constraints = []; var c1 = DatasetFactory.createConstraint("metadata#active", true, true, ConstraintType.MUST); constraints.push(c1); var c1 = DatasetFactory.createConstraint("tablename", "tbCamposAdicionais", "tbCamposAdicionais", ConstraintType.MUST); constraints.push(c1); var dsCampoCustomizado = DatasetFactory.getDataset("dpf_configuracao_admissao_digital", null, constraints, null); if (dsCampoCustomizado != undefined && dsCampoCustomizado != null && dsCampoCustomizado.rowsCount > 0) { for(var i = 0; i < dsCampoCustomizado.rowsCount; i++){ if ( dsCampoCustomizado.getValue(i,"nomeCampoAdicional") != null && dsCampoCustomizado.getValue(i,"nomeCampoAdicional") != "null" && dsCampoCustomizado.getValue(i,"nomeCampoAdicional") != "") { dataset.addRow([ "", dsCampoCustomizado.getValue(i, "nomeCampoAdicional") + "", dsCampoCustomizado.getValue(i, "labelCampoAdicional") + "", "campoAdicional" ]); } } } } /*verifica se admissao digitla esta ativa para liberar os campos especificos*/ } log.info("Digte Public Form - @@@ Fim Dataset ds_dpf_listaCampoStatus.js"); return dataset; }