function defineStructure() {} function onSync(lastSyncDate) {} function createDataset(fields, constraints, sortFields) { log.info("-> In√≠cio | Dataset | fdwt_bolao_ranking_campeonato.js"); var dataset = DatasetBuilder.newDataset(); if (constraints != null) { for (var i = 0; i < constraints.length; i++) { if (constraints[i].fieldName == "pCampeonato") { c1 = DatasetFactory.createConstraint("pCampeonato", constraints[i].initialValue, constraints[i].initialValue, ConstraintType.MUST); } } } dataset.addColumn("JOGADOR_ID"); dataset.addColumn("JOGADOR_LOGIN"); dataset.addColumn("JOGADOR_NOME"); dataset.addColumn("PONTUACAO"); var dsPalpite = DatasetFactory.getDataset("fdwt_bolao_palpite", null, new Array(c1), null); var hJogadorPontuacao = new java.util.HashMap(); for (var i = 0; i < dsPalpite.rowsCount; i++) { var DOCUMENTID = dsPalpite.getValue(i, "documentid"); var CAMPEONATO = dsPalpite.getValue(i, "pCampeonato"); var JOGADOR = dsPalpite.getValue(i, "pJogadorMatricula"); var JOGO_ID = dsPalpite.getValue(i, "pJogo"); var PONTUACAO = (dsPalpite.getValue(i, "pPontuacao") == null || dsPalpite.getValue(i, "pPontuacao") == "" ? "0" : dsPalpite.getValue(i, "pPontuacao")); if (hJogadorPontuacao.containsKey(JOGADOR)) { var pontuacaoAntiga = parseInt(hJogadorPontuacao.get(JOGADOR)); var pontuacaoNova = parseInt(PONTUACAO); var total = pontuacaoAntiga + pontuacaoNova; hJogadorPontuacao.put(JOGADOR, total); } else { hJogadorPontuacao.put(JOGADOR, parseInt(PONTUACAO)); } } var iterator = hJogadorPontuacao.keySet().iterator(); while (iterator.hasNext()) { var jogadorId = iterator.next(); var jogadorLogin = getColleagueName(jogadorId).getValue(0, "login"); var jogadorNome = getColleagueName(jogadorId).getValue(0, "colleagueName"); var pontuacao = hJogadorPontuacao.get(jogadorId); dataset.addRow(new Array(jogadorId, jogadorLogin, jogadorNome, pontuacao)); } log.info("-> BeforeReturn | Dataset | fdwt_bolao_ranking_campeonato.js"); return dataset; } function onMobileSync(user) {} function getColleagueName(colleagueId) { var c1 = DatasetFactory.createConstraint('colleaguePK.colleagueId', colleagueId, colleagueId, ConstraintType.MUST); var dsColleague = DatasetFactory.getDataset('colleague', new Array('login', 'colleagueName'), new Array(c1), null); return dsColleague; }