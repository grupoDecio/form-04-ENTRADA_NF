function createDataset(fields, constraints, sortFields) { log.info("Digte Public Form - @@@ Inicio Dataset ds_dpf_listaCamposVisualizacao.js"); var dataset = DatasetBuilder.newDataset(); var codigoFormularioPublico = ""; if (constraints != null && constraints.length > 0) { for (var c = 0; c < constraints.length; c++) { if (constraints[c].fieldName == "co" && constraints[c].initialValue != "") { codigoFormularioPublico = constraints[c].initialValue; } if (constraints[c].fieldName == "co" && constraints[c].initialValue != "") { codigoFormularioPublico = constraints[c].initialValue; } } if (codigoFormularioPublico != "") { var cCodForm = DatasetFactory.createConstraint("codigoFormularioPublico", codigoFormularioPublico, codigoFormularioPublico, ConstraintType.MUST); var dsConfig = DatasetFactory.getDataset("dpf_configuracoes", ["metadata#id", "metadata#version","permitirAnexo","permitirMsg"], [cCodForm], null); if (dsConfig != undefined && dsConfig != null && dsConfig.rowsCount > 0) { var documentId = dsConfig.getValue(0, "metadata#id"); var documentVersion = dsConfig.getValue(0, "metadata#version"); var permitirAnexo = dsConfig.getValue(0, "permitirAnexo"); var permitirMsg = dsConfig.getValue(0, "permitirMsg"); var c1 = DatasetFactory.createConstraint("tablename", "tbCamposIdentificacao", "tbCamposIdentificacao", ConstraintType.MUST); var c2 = DatasetFactory.createConstraint("metadata#id", documentId, documentId, ConstraintType.MUST); var c3 = DatasetFactory.createConstraint("metadata#version", documentVersion, documentVersion, ConstraintType.MUST); var c4 = DatasetFactory.createConstraint("metadata#active", "true", "true", ConstraintType.MUST); var c5 = DatasetFactory.createConstraint("campoVisivel", "nao", "nao", ConstraintType.MUST_NOT); var constrCampos = [c1, c2, c3, c4, c5]; var dsCcampos = DatasetFactory.getDataset("dpf_configuracoes", ["campo", "descricaoCampo", "campoIdentificacao", "campoVisivel"], constrCampos, null); dataset.addColumn("campo"); dataset.addColumn("descricaoCampo"); dataset.addColumn("campoIdentificacao"); dataset.addColumn("campoVisivel"); dataset.addColumn("permitirAnexo"); dataset.addColumn("permitirMsg"); if (dsCcampos != undefined && dsCcampos != null && dsCcampos.rowsCount > 0) { for (var i = 0; i < dsCcampos.rowsCount; i++) { dataset.addRow([dsCcampos.getValue(i, "campo"), dsCcampos.getValue(i, "descricaoCampo"), dsCcampos.getValue(i, "campoIdentificacao"), dsCcampos.getValue(i, "campoVisivel"),permitirAnexo,permitirMsg]); } } } } } log.info("Digte Public Form - @@@ Fim Dataset ds_dpf_listaCamposVisualizacao.js"); return dataset; } function retirarPorcento(valor){ valor = valor.substr(1, valor.length - 2); return valor; }